/**
 * @license RequireJS text 0.27.1 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/**
 * Copyright (c) 2011-2013 Felix Gnass
 * Licensed under the MIT license
 */

/**
 * Copyright 2013 Craig Campbell
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Mousetrap is a simple keyboard shortcut library for Javascript with
 * no external dependencies
 *
 * @version 1.4.2
 * @url craig.is/killing/mice
 */

define("marker",{}),define("backlog/collections/issues",[],function(){var e={fetch:function(e,t){var n=this;$.ajax({url:"/api/"+e+"/"+t+"/backlog",dataType:"json",success:function(e){n.trigger("ondatareceived",e)}})}};return _.extend(e,Backbone.Events),e}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||undefined),u=[];define("text",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(e){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&!!process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){t(l.readFileSync(e,"utf8"))}):typeof Packages!="undefined"&&(f=function(e,t){var n="utf-8",r=new java.io.File(e),i=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),n)),o,u,a="";try{o=new java.lang.StringBuffer,u=s.readLine(),u&&u.length()&&u.charAt(0)===65279&&(u=u.substring(1)),o.append(u);while((u=s.readLine())!==null)o.append(i),o.append(u);a=String(o.toString())}finally{s.close()}t(a)}),a={version:"0.27.1",strip:function(e){if(e){e=e.replace(t,"");var r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw new Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s,o,u;return i?(s=i[2],o=i[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===t)&&(!o||o===n)&&(!u&&!o||u===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&i.inlineText&&(u[e]=n),r(n)},load:function(e,t,n,u){var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})},write:function(e,t,n,r){if(t in u){var i=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,t,n,r,i){var s=a.parseName(t),o=s.moduleName+"."+s.ext,u=n.toUrl(s.moduleName+"."+s.ext)+".js";a.load(o,n,function(t){var n=function(e){return r(u,e)};n.asModule=function(e,t){return r.asModule(e,u,t)},a.write(e,o,n,i)},i)}},a})}(),define("text!backlog/templates/board.html",[],function(){return'<div class="backlog">\n</div>\n'}),define("text!backlog/templates/column.html",[],function(){return'<h3><%- milestone.title %></h3>\n<ul class="sortable"></ul>\n'}),define("text!backlog/templates/card.html",[],function(){return'<a href="#"  title="Close issue" class="close ui-icon ui-icon-x"><span></span></a>\n<div class="card-header">\n  <div class="title" title="<%- title %>">\n    <%- title %>\n  </div>\n  <a class="number" href="<%= html_url %>" target="_blank" title="View issue on github.com"><small>#</small><%= number %></a>\n</div>\n<% if(assignee) { %>\n <img data-placement="right" rel="twipsy" title="Assigned to <%= assignee.login %>" src="https://secure.gravatar.com/avatar/<%= assignee.gravatar_id %>?s=24" />\n<% } %>\n\n<% if(milestone) { %>\n<div class="milestone">\n   Milestone: <%- milestone.title %>\n</div>\n<% } %>\n<% if (pull_request.html_url) { %><span class="label label-info">Pull request</span> <%}%>\n<div class="card-labels">\n<% _(other_labels).each(function(l) { %>\n<div class="card-label-wrapper"> \n  <div class="card-label -x<%= l.color %> active small"> \n  </div>\n  <div class="card-label -x<%= l.color %> active large"> \n    <span> <%- l.name %> </span>\n  </div>\n</div>\n\n<% }); %>\n\n</div>\n'}),define("common/events/postal",["socket"],function(e){function t(){return((1+Math.random())*65536|0).toString(16).substring(1)}function n(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}var r={},i=n();return{correlationId:i,subscribe:function(e,t){postal.channel(e).subscribe(t)},channel:function(e){return postal.channel(e)},publish:function(e,t){postal.channel(e).publish(t)},socket:function(t,n,s){if(!e)return;var o=postal.channel(t);postal.channel(n).subscribe(s);if(r[t])return;r[t]=t,e.on(t,function(e){e.correlationId!==i&&postal.channel(e.event).publish(e.payload)})}}}),define("backlog/models/card",["../../common/events/postal"],function(e){var t=function(e){this.attributes=e.model,this.user=e.user,this.repo=e.repo};return _.extend(t.prototype,{save:function(t){$.post("/api/"+this.attributes.repo.owner.login+"/"+this.attributes.repo.name+"/assignmilestone",{milestone:t.milestone,issue:this.attributes,correlationId:e.correlationId},function(e){})},close:function(t){$.post("/api/"+this.attributes.repo.owner.login+"/"+this.attributes.repo.name+"/close",{index:t.index,issue:this.attributes,correlationId:e.correlationId},function(e){})},assign:function(t){this.attributes.assignee=t,$.post("/api/"+this.attributes.repo.owner.login+"/"+this.attributes.repo.name+"/assigncard",{issue:this.attributes,correlationId:e.correlationId,assignee:t.login},function(e){})},reorder:function(t){$.post("/api/"+this.attributes.repo.owner.login+"/"+this.attributes.repo.name+"/reorderissue",{index:t.order,issue:this.attributes,correlationId:e.correlationId},function(e){})}}),t}),define("backlog/views/cardView",["text!../templates/card.html","../models/card","../../common/events/postal"],function(e,t,n){return Backbone.View.extend({initialize:function(e){this.issue=new t({model:e.issue,user:e.user,repo:e.repo}),_.bind(this,"moved",this.moved),_.bind(this,"reorder",this.drop),n.subscribe("Filter.Simple",$.proxy(this.simpleFilter,this)),n.subscribe("Filter.Complex",$.proxy(this.complexFilter,this)),n.socket(e.user+"/"+e.repo,"Closed."+e.issue.number,$.proxy(this.onClosed,this)),n.socket(e.user+"/"+e.repo,"Assigned."+e.issue.number,$.proxy(this.onAssigned,this)),n.socket(e.user+"/"+e.repo,"Updated."+e.issue.number,$.proxy(this.onUpdated,this)),this.filtersHash={simple:{},complex:{}}},events:{moved:"moved","click .close":"closed",drop:"dropped",reorder:"drop","click .number":"onNumber",click:"fullscreen"},tagName:"li",onMoved:function(e){n.publish("Moved.Socket."+e.index,{card:this})},onNumber:function(e){e.stopPropagation()},onUpdated:function(e){this.issue.attributes=_.extend(this.issue.attributes,e.issue),this.render(),this.transition()},onClosed:function(){this.remove(),n.publish("Closed.Issue",{card:this})},fullscreen:function(e){n.publish("Card.Fullscreen",this.issue)},render:function(){$(this.el).html(_.template(e,this.issue.attributes)).droppable({scope:"assignee",hoverClass:"assignee-accept"}).data("issue",this.issue.attributes);if(this.issue.attributes.repo.color){var t=$.Color("#"+this.issue.attributes.repo.color),n="3px solid "+$.Color(t.alpha(.5)).toRgbaString();$(this.el).css({"border-left":n})}return this},moved:function(e,t){this.issue.save({milestone:t.milestone})},dropped:function(e,t){var n=$(t.draggable).data("assignee");this.issue.assign(n),this.onAssigned({assignee:n})},onAssigned:function(e){this.issue.attributes.assignee=e.assignee,this.render()},closed:function(e,t){e.preventDefault(),this.issue.close({index:t}),this.remove(),n.publish("Closed.Issue",{card:this})},transition:function(){var e=[],t=this;setTimeout(function(){for(var n in t.filtersHash.simple)e.push(t.filtersHash.simple[n]);var r=_.filter(e,function(e){return e.state===1}),i=_.filter(e,function(e){return e.state===2});if(_.any(i,function(e){return!e.condition(t.issue.attributes)})){$(t.el).addClass("hide").removeClass("dim active");return}if(_.any(r,function(e){return!e.condition(t.issue.attributes)})){$(t.el).addClass("dim").removeClass("hide active");return}$(t.el).removeClass("dim hide active"),(r.length||i.length)&&$(t.el).addClass("active")},0)},simpleFilter:function(e){var t=this;this.filtersHash.simple[e.id]=e,this.transition()},drop:function(e,t){this.issue.reorder({order:t})}})}),define("backlog/models/milestone",[],function(){var e=function(e){this.attributes=e.model,this.user=e.user,this.repo=e.repo};return _.extend(e.prototype,{save:function(e){if(!e.order||e.order===0)console.error("something wrong happened index should not be 0"),console.log("falling back to original number",this.attributes.number),e.order=this.attributes.number;$.post("/api/"+this.user+"/"+this.repo+"/reordermilestone",{index:e.order,status:e.status,milestone:this.attributes},function(e){})}}),e}),define("backlog/views/columnView",["text!../templates/column.html","./cardView","../../common/events/postal","../models/milestone"],function(e,t,n,r){var i=Backbone.View.extend({initialize:function(e){this.column=e.column,this.repo=e.repo,this.user=e.user,this.milestone=new r({model:this.column.milestone,user:e.user,repo:e.repo}),_.bind("reordered",this.reordered)},tagName:"div",className:"column",events:{reorder:"reordered"},reordered:function(e,t){this.milestone.save(t)},onOpened:function(e){var r=new t({issue:e,user:this.user,repo:this.repo});$("ul",this.el).append(r.render().el),n.publish("Opened.Issue",e)},onSocket:function(e){var t=$("li",this.el),n=t.index(e.card.el);if(n!==-1)return;$("ul",this.el).append(e.card.el)},render:function(){var n=$(_.template(e,this.column)),r=this,i=_.map(this.column.issues,function(e){var n=new t({issue:e,user:r.user,repo:r.repo});return n.render().el});return $(this.el).append(n).data("milestone",this.column.milestone).find("ul").append(i),$("ul",this.el).sortable({helper:"clone",connectWith:".sortable",placeholder:"ui-sortable-placeholder",receive:$.proxy(this.onReceive,this),remove:$.proxy(this.onRemove,this),over:$.proxy(this.onOver,this),update:$.proxy(this.onStop,this),out:$.proxy(this.onOut,this)}),this},onReceive:function(e,t){$(t.item).trigger("moved",this.column)},onRemove:function(e,t){},onOver:function(e,t){$("ul",this.el).addClass("ui-sortable-hover")},onOut:function(e,t){$("ul",this.el).removeClass("ui-sortable-hover")},onStop:function(e,t){var n=$("li",this.el),r=n.index(t.item);if(r===-1)return;var i=r===0,s=r===n.size()-1,o=$(t.item),u=o.data("issue"),a=n.get(r?r-1:r),f=n.index(a),l=$(a).data("issue"),c=n.get(n.size()-1>r?r+1:r),h=n.index(c),p=$(c).data("issue"),d=u._data.order||u.number,v=l._data.order||l.number,m=p._data.order||p.number;if(i&&s)return;i?(u._data.order=(m||1)/2,o.trigger("reorder",u._data.order).data("issue",u)):s?(u._data.order=v+1,o.trigger("reorder",u._data.order).data("issue",u)):(u._data.order=(m+v||1)/2,o.trigger("reorder",u._data.order).data("issue",u))}});return i}),define("backlog/views/filterView",["../../common/events/postal"],function(e){return jQuery.Color.fn.contrastColor=function(){var e=this._rgba[0],t=this._rgba[1],n=this._rgba[2];return(e*299+t*587+n*144)/1e3>=131.5?"#333":"white"},Backbone.View.extend({tagName:"li",className:"filter",initialize:function(e){this.params=e,this.condition=e.condition,this.name=e.name,this.type=e.type||"Simple",this.state=0,this.states=[0,1,2,0]},events:{click:"clicked",clear:"clearAndPublish","click .ui-icon":"clearAndPublish"},render:function(){return $(this.el).html("<a href='#'>"+this.name+"<span class='ui-icon ui-icon-x'></span></a>").addClass("-x"+this.params.color.substring(1)).data("filter",this),this},clicked:function(e){e.preventDefault();switch(this.state=this.states[this.state+1]){case 0:this.clear();break;case 1:this.fade();break;case 2:this.solid()}this.publish()},clear:function(){$(this.el).find("a").removeClass("dim").removeClass("active")},publish:function(){e.publish("Filter."+this.type,{id:this.cid,condition:this.condition,state:this.state})},clearAndPublish:function(e){return e.preventDefault(),this.state=0,this.publish(),this.clear(),!1},fade:function(){$(this.el).find("a").addClass("dim").removeClass("active")},solid:function(){$(this.el).find("a").addClass("active").removeClass("dim")}})}),define("backlog/views/sidebarView",["../../common/events/postal","./filterView"],function(e,t){return Backbone.View.extend({tagName:"ul",className:"filters",initialize:function(e){this.login=e.params.login,this.labels=e.data.other_labels},render:function(){var e=$(this.el),n=this.login,r=(new t({color:"#0069D6",name:"Assigned to me",condition:function(e){return e.assignee&&e.assignee.login===n}})).render(),i=(new t({color:"#0069D6",name:"Assigned to others",condition:function(e){return e.assignee&&e.assignee.login!==n}})).render(),s=(new t({color:"#0069D6",name:"Unassigned issues",condition:function(e){return!e.assignee}})).render(),o=$([r.el,i.el,s.el]);e.append(o),o.click(function(e){e.preventDefault();var t=$(this),n=t.data("filter"),r=_(o).filter(function(e){var t=$(e).data("filter");return n.cid!==t.cid&&t.state!==0});_(r).each(function(e){$(e).trigger("clear")})});var u=_.map(this.labels,function(e){return(new t({color:"#"+e.color,name:e.name,condition:function(t){return _.any(t.labels,function(t){return t.name.toLocaleLowerCase()===e.name.toLocaleLowerCase()})}})).render().el});return e.append("<h5>Labels</h5>"),e.append(u),this}})}),define("backlog/views/headerView",["../../common/events/postal"],function(e){return Backbone.View.extend({el:$(".page-header-wrapper"),events:{"keyup input":"onkeyup"},initialize:function(t){var n=this;this.publish=_.debounce(function(){var t=$(n.el).find("input").val();e.publish("Filter.Simple",{id:"search",condition:function(e){return e.title.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())!==-1},state:2})},300)},onkeyup:function(e){this.publish()}})}),define("text!common/templates/assignee.html",[],function(){return'<li class="assignee" data-login="<%= login %>">\n  <img src="https://secure.gravatar.com/avatar/<%= gravatar_id %>?s=24" title="<%=login %>" alt="<%= login %>"/>\n</li>\n'}),define("common/views/assigneeView",["../../common/events/postal","text!../templates/assignee.html"],function(e,t){return Backbone.View.extend({el:$(".page-header-wrapper"),initialize:function(e){var t=this;t.data=e.data,t.state=0,t.classes=[["",""],["dim","active"],["hide","active"]],t.render()},events:{"click li":"filter"},filter:function(t){var n=this,r=$(t.currentTarget),i=r.data("login"),s=n.state;s=(s+1)%3,e.publish("Filter.Simple",{condition:function(e){return e.assignee&&e.assignee.login===i},state:s}),s===1&&(n.$("li").removeClass("active inactive").addClass("dim"),r.removeClass("dim").addClass("active")),s===2&&(n.$("li").removeClass("active inactive").addClass("inactive"),r.removeClass("dim inactive").addClass("active")),s===0&&n.$("li").removeClass("dim active inactive"),n.state=s},render:function(){var e=$(this.el).find("ol"),n=_(this.data.assignees).chain().map(function(e){return $(_.template(t,e)).data("assignee",e)}).value();return e.append(n),e.find("li").draggable({helper:"clone",scope:"assignee",zIndex:100,appendTo:"body"}),this}})}),define("text!backlog/templates/css.html",[],function(){return'<% \n_(["filter","card-label"]).each(function(name){\n  _(other_labels).each(function(l) {\n%>\n  .<%= name %>.-x<%= l.color %>.active, .<%= name %>.-x<%= l.color %>.active:hover  {\n    background-color: #<%= l.color %>;\n    background-color: <%= $.Color("#" + l.color).toString() %>;\n    color: <%= $.Color("#" + l.color).contrastColor() %>;\n  }\n\n  .<%= name %>.-x<%= l.color %> .active, .<%= name %>.-x<%= l.color %> .active:hover  {\n    background-color: #<%= l.color %>;\n    background-color: <%= $.Color("#" + l.color).toString() %>;\n    color: <%= $.Color("#" + l.color).contrastColor() %>;\n  }\n  \n  .<%= name %>.-x<%= l.color %>.dim, .<%= name %>.-x<%= l.color %>.dim:hover  {\n    background-color: <%= $.Color($.Color("#" + l.color).alpha(0.6)).toString() %>;\n    color: <%= $.Color("#" + l.color).contrastColor() %>;\n  }\n\n  .<%= name %>.-x<%= l.color %> .dim ,  .<%= name %>.-x<%= l.color %> .dim:hover {\n    background-color: <%= $.Color($.Color("#" + l.color).alpha(0.6)).toString() %>;\n    color: <%= $.Color("#" + l.color).contrastColor() %>;\n  }\n\n  <%})});%>\n'}),define("backlog/views/cssView",["../collections/issues","text!../templates/css.html"],function(e,t){e.bind("ondatareceived",function(e){var n=_.template(t,e),r=document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n)),r.appendChild(i)})}),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("common/spin",t):e.Spinner=t()}(this,function(){function r(e,t){var n=document.createElement(e||"div"),r;for(r in t)n[r]=t[r];return n}function i(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function o(e,r,i,o){var u=["opacity",r,~~(e*100),i,o].join("-"),a=.01+i/o*100,f=Math.max(1-(1-e)/r*(100-a),e),l=n.substring(0,n.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return t[u]||(s.insertRule("@"+c+"keyframes "+u+"{"+"0%{opacity:"+f+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+r)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",s.cssRules.length),t[u]=1),u}function u(t,n){var r=t.style,i,s;if(r[n]!==undefined)return n;n=n.charAt(0).toUpperCase()+n.slice(1);for(s=0;s<e.length;s++){i=e[s]+n;if(r[i]!==undefined)return i}}function a(e,t){for(var n in t)e.style[u(e,n)||n]=t[n];return e}function f(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]===undefined&&(e[r]=n[r])}return e}function l(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function h(e){if(typeof this=="undefined")return new h(e);this.opts=f(e||{},h.defaults,c)}function p(){function e(e,t){return r("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}s.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(t,n){function o(){return a(e("group",{coordsize:s+" "+s,coordorigin:-r+" "+ -r}),{width:s,height:s})}function c(t,s,u){i(f,i(a(o(),{rotation:360/n.lines*t+"deg",left:~~s}),i(a(e("roundrect",{arcsize:n.corners}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:u}),e("fill",{color:n.color,opacity:n.opacity}),e("stroke",{opacity:0}))))}var r=n.length+n.width,s=2*r,u=-(n.width+n.length)*2+"px",f=a(o(),{position:"absolute",top:u,left:u}),l;if(n.shadow)for(l=1;l<=n.lines;l++)c(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=n.lines;l++)c(l);return i(t,f)},h.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}var e=["webkit","Moz","ms","O"],t={},n,s=function(){var e=r("style",{type:"text/css"});return i(document.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),c={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};h.defaults={},f(h.prototype,{spin:function(e){this.stop();var t=this,i=t.opts,s=t.el=a(r(0,{className:i.className}),{position:i.position,width:0,zIndex:i.zIndex}),o=i.radius+i.length+i.width,u,f;e&&(e.insertBefore(s,e.firstChild||null),f=l(e),u=l(s),a(s,{left:(i.left=="auto"?f.x-u.x+(e.offsetWidth>>1):parseInt(i.left,10)+o)+"px",top:(i.top=="auto"?f.y-u.y+(e.offsetHeight>>1):parseInt(i.top,10)+o)+"px"})),s.setAttribute("role","progressbar"),t.lines(s,t.opts);if(!n){var c=0,h=(i.lines-1)*(1-i.direction)/2,p,d=i.fps,v=d/i.speed,m=(1-i.opacity)/(v*i.trail/100),g=v/i.lines;(function y(){c++;for(var e=0;e<i.lines;e++)p=Math.max(1-(c+(i.lines-e)*g)%v*m,i.opacity),t.opacity(s,e*i.direction+h,p,i);t.timeout=t.el&&setTimeout(y,~~(1e3/d))})()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=undefined),this},lines:function(e,t){function l(e,n){return a(r(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*s+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}var s=0,u=(t.lines-1)*(1-t.direction)/2,f;for(;s<t.lines;s++)f=a(r(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:n&&o(t.opacity,t.trail,u+s*t.direction,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&i(f,a(l("#000","0 0 4px #000"),{top:"2px"})),i(e,i(f,l(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}});var d=a(r("group"),{behavior:"url(#default#VML)"});return!u(d,"transform")&&d.adj?p():n=u(d,"animation"),h}),define("common/spinner",["./spin"],function(e){var t={lines:13,length:17,width:3,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:.7,trail:60,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},n=new e(t);return n}),define("backlog/views/board",["../collections/issues","text!../templates/board.html","./columnView","./sidebarView","./headerView","../../common/views/assigneeView","../../common/events/postal","./cssView","../../common/spinner"],function(e,t,n,r,i,s,o,u,a){var f=function(){var e=_($("ul")).chain().map(function(e){return $(e).height()}).reduce(function(e,t){return t>e?t:e}).value();return e},l=function(e){switch(e){case"open":$("#drawer").find(".toggle-drawer").removeClass("arrow-right").addClass("arrow-left").end().animate({left:"+=270px"},300),$("#content").animate({"margin-left":"+=100px"},300);break;case"close":$("#drawer").animate({left:"-=270px"},300,function(){$(this).find(".toggle-drawer").removeClass("arrow-left").addClass("arrow-right").end()}),$("#content").animate({"margin-left":"-=100px"},300)}};return Backbone.View.extend({el:$("#stage"),events:{"click .toggle-drawer":"toggleDrawer"},initialize:function(t){e.bind("ondatareceived",this.onfetch,this),this.overlay=$("<div class='fullscreen-overlay'>"),$("#wrapper").append(this.overlay.show()),a.spin(this.overlay.get(0)),e.fetch(t.user,t.repo),this.user=t.user,this.repo=t.repo,this.params=t,o.subscribe("Opened.Issue",$.proxy(this.onOpened,this)),o.subscribe("Closed.Issue",$.proxy(this.onClosed,this))},onOpened:function(){this.resizeColumns()},onClosed:function(){this.resizeColumns()},onfetch:function(e){this.overlay.remove();var o=$(_.template(t,e)),u=o.clone(),a=e.unassigned,f=new r({data:e,params:this.params}),l=new i,c=new s({data:e,params:this.params}),h=this;$(u).append((new n({column:a,user:this.user,repo:this.repo})).render().el),_.each(e.milestones,function(e){var t=new n({column:e,user:h.user,repo:h.repo}),r=$(t.render().el).css({width:"260px"});$(o).append(r)}),$("#stage").append(o),$(o).sortable({axis:"x",handle:"h3",cursor:"move",stop:$.proxy(this.fullStop,this),start:$.proxy(this.onStart,this),remove:$.proxy(this.onRemove,this),over:$.proxy(this.onOver,this),update:$.proxy(this.onStop,this)}),$("#drawer","#main-stage").append(u).find(".toggle-drawer").show(),$(".sidebar-wrapper").append(f.render().el).show(),$('[rel~="twipsy"]').tooltip({live:!0}),this.resizeColumns()},resizeColumns:function(){var e=f();$("ul","#main-stage").css("min-height",e)},toggleDrawer:function(e){e.preventDefault();var t=$(".toggle-drawer").hasClass("arrow-left");t?l("close"):l("open")},onReceive:function(e,t){},onRemove:function(e,t){},onOver:function(e,t){},onOut:function(e,t){},fullStop:function(e,t){$(t.item).removeClass("ui-state-dragging")},onStart:function(e,t){$(t.item).addClass("ui-state-dragging")},onStop:function(e,t){var n=$(".backlog > div",this.el),r=n.index(t.item);if(r===-1)return;var i=r===0,s=r===n.size()-1,o=$(t.item),u=o.data("milestone"),a=n.get(r?r-1:r),f=n.index(a),l=$(a).data("milestone"),c=n.get(n.size()-1>r?r+1:r),h=n.index(c),p=$(c).data("milestone"),d=u._data.order||u.number,v=l._data.order||l.number,m=p._data.order||p.number;if(i&&s)u._data.order=d;else if(i){var g=m||1;u._data.order=g-1>0?g-1:g/2}else s?u._data.order=v+1:u._data.order=(m+v||1)/2;o.trigger("reorder",{order:u._data.order}).data("milestone",u)}})}),define("backlog/main",["./views/board"],function(e){var t={};return{init:function(n){t.board=new e(n)}}}),define("board/collections/issues",[],function(){var e={fetch:function(e,t){var n=this,r=$.ajax({url:"/api/"+e+"/"+t+"/board",dataType:"json",success:function(e){}}),i=$.ajax({url:"/api/"+e+"/"+t+"/column",dataType:"json"});$.when(r).then(function(r){if(!r.labels.length){window.location.href="/"+e+"/"+t+"/board/create";return}n.trigger("ondatareceived",r),_.each(r.labels,function(e){n.trigger("onissuesreceived."+e.index,e.issues)}),n.trigger("afterreceived"),$.when(i).then(function(e){n.trigger("onissuesreceived."+e.index,e.issues),n.trigger("afterreceived")})})}};return _.extend(e,Backbone.Events),e}),define("text!board/templates/board.html",[],function(){return'<div class="board">\n</div>\n'}),define("text!board/templates/column.html",[],function(){return'<div class="column">\n<h3><%- text %></h3>\n<ul class="sortable"></ul>\n</div>\n'}),define("text!board/templates/card.html",[],function(){return'<a href="#"  title="Close issue" class="close ui-icon ui-icon-x"><span></span></a>\n<div class="card-header">\n  <div class="title" title="<%- title %>">\n    <%- title %>\n  </div>\n  <a class="number" href="<%= html_url %>" target="_blank" title="View issue on github.com"><small>#</small><%= number %></a>\n</div>\n<% if(assignee) { %>\n <img data-placement="right" rel="twipsy" title="Assigned to <%= assignee.login %>" src="https://secure.gravatar.com/avatar/<%= assignee.gravatar_id %>?s=24" />\n<% } %>\n\n<% if(milestone) { %>\n<div class="milestone">\n   Milestone: <%- milestone.title %>\n</div>\n<% } %>\n<% if(pull_request.html_url) { %>\n  <span class="label label-info">Pull request</span>\n<% } %>\n<div class="card-labels">\n<% _(other_labels).each(function(l) { %>\n<div class="card-label-wrapper"> \n  <div class="card-label -x<%= l.color %> active small"> \n  </div>\n  <div class="card-label -x<%= l.color %> active large"> \n    <span> <%- l.name %> </span>\n  </div>\n</div>\n\n<% }); %>\n\n</div>\n'}),define("board/models/card",["../../common/events/postal"],function(e){var t=function(e){this.attributes=e.model,this.user=e.user,this.repo=e.repo};return _.extend(t.prototype,{save:function(t){$.post("/api/"+this.attributes.repo.owner.login+"/"+this.attributes.repo.name+"/movecard",{index:t.index,issue:this.attributes,correlationId:e.correlationId},function(e){})},close:function(t){$.post("/api/"+this.attributes.repo.owner.login+"/"+this.attributes.repo.name+"/close",{index:t.index,issue:this.attributes,correlationId:e.correlationId},function(e){})},assign:function(t){this.attributes.assignee=t,$.post("/api/"+this.attributes.repo.owner.login+"/"+this.attributes.repo.name+"/assigncard",{issue:this.attributes,correlationId:e.correlationId,assignee:t.login},function(e){})},reorder:function(t){$.post("/api/"+this.attributes.repo.owner.login+"/"+this.attributes.repo.name+"/reorderissue",{index:t.order,issue:this.attributes,correlationId:e.correlationId},function(e){})}}),t}),define("board/views/cardView",["text!../templates/card.html","../models/card","../../common/events/postal"],function(e,t,n){return Backbone.View.extend({initialize:function(e){this.issue=new t({model:e.issue,user:e.user,repo:e.repo}),_.bind(this,"moved",this.moved),_.bind(this,"reorder",this.drop),n.subscribe("Filter.Simple",$.proxy(this.simpleFilter,this)),n.subscribe("Filter.Complex",$.proxy(this.complexFilter,this)),n.socket(e.user+"/"+e.repo,"Moved."+e.issue.number,$.proxy(this.onMoved,this)),n.socket(e.user+"/"+e.repo,"Closed."+e.issue.number,$.proxy(this.onClosed,this)),n.socket(e.user+"/"+e.repo,"Assigned."+e.issue.number,$.proxy(this.onAssigned,this)),n.socket(e.user+"/"+e.repo,"Updated."+e.issue.number,$.proxy(this.onUpdated,this)),this.filtersHash={simple:{},complex:{}}},events:{moved:"moved","click .close":"closed",drop:"dropped",reorder:"drop","click .number":"onNumber",click:"fullscreen"},tagName:"li",onNumber:function(e){e.stopPropagation()},onMoved:function(e){n.publish("Moved.Socket."+e.index,{card:this})},onUpdated:function(e){this.issue.attributes=_.extend(this.issue.attributes,e.issue),this.render(),this.transition()},onClosed:function(){this.remove(),n.publish("Closed.Issue",{card:this})},fullscreen:function(e){n.publish("Card.Fullscreen",this.issue)},render:function(){$(this.el).html(_.template(e,this.issue.attributes)).droppable({scope:"assignee",hoverClass:"assignee-accept"}).data("issue",this.issue.attributes);if(this.issue.attributes.repo.color){var t=$.Color("#"+this.issue.attributes.repo.color),n="3px solid "+$.Color(t.alpha(.5)).toRgbaString();$(this.el).css({"border-left":n})}return this},moved:function(e,t){this.issue.save({index:t})},dropped:function(e,t){var n=$(t.draggable).data("assignee");this.issue.assign(n),this.onAssigned({assignee:n})},onAssigned:function(e){this.issue.attributes.assignee=e.assignee,this.render()},closed:function(e,t){e.preventDefault(),e.stopPropagation(),this.issue.close({index:t}),this.remove(),n.publish("Closed.Issue",{card:this})},transition:function(){var e=[],t=this;setTimeout(function(){for(var n in t.filtersHash.simple)e.push(t.filtersHash.simple[n]);var r=_.filter(e,function(e){return e.state===1}),i=_.filter(e,function(e){return e.state===2});if(_.any(i,function(e){return!e.condition(t.issue.attributes)})){$(t.el).addClass("hide").removeClass("dim active");return}if(_.any(r,function(e){return!e.condition(t.issue.attributes)})){$(t.el).addClass("dim").removeClass("hide active");return}$(t.el).removeClass("dim hide active"),(r.length||i.length)&&$(t.el).addClass("active")},0)},simpleFilter:function(e){var t=this;this.filtersHash.simple[e.id]=e,this.transition()},drop:function(e,t){this.issue.reorder({order:t})}})}),define("board/views/columnView",["../collections/issues","text!../templates/column.html","./cardView","../../common/events/postal"],function(e,t,n,r){var i=Backbone.View.extend({initialize:function(t){this.column=t.column,this.repo=t.repo,this.user=t.user,this.latched=!1,r.subscribe("Moved.Socket."+t.column.index,$.proxy(this.onSocket,this)),r.socket(t.user+"/"+t.repo,"Opened."+t.column.index,$.proxy(this.onOpened,this)),e.bind("onissuesreceived."+t.column.index,this.onfetch,this)},onfetch:function(e){var t=_.map(e,function(e){var t=new n({issue:e,user:self.user,repo:self.repo});return t.render().el});$("ul",this.el).append(t)},onOpened:function(e){var t=new n({issue:e,user:this.user,repo:this.repo});$("ul",this.el).append(t.render().el),r.publish("Opened.Issue",e)},onSocket:function(e){var t=$("li",this.el),n=t.index(e.card.el);if(n!==-1)return;$("ul",this.el).append(e.card.el)},render:function(){var e=$(_.template(t,this.column)),n=this;return this.el=e,$("ul",this.el).sortable({helper:"clone",connectWith:".sortable",placeholder:"ui-sortable-placeholder",receive:$.proxy(this.onReceive,this),remove:$.proxy(this.onRemove,this),over:$.proxy(this.onOver,this),update:$.proxy(this.onStop,this),out:$.proxy(this.onOut,this)}),this},onReceive:function(e,t){$(t.item).trigger("moved",this.column.index)},onRemove:function(e,t){},onOver:function(e,t){$("ul",this.el).addClass("ui-sortable-hover")},onOut:function(e,t){$("ul",this.el).removeClass("ui-sortable-hover")},onStop:function(e,t){var n=$("li",this.el),r=n.index(t.item);if(r===-1)return;var i=r===0,s=r===n.size()-1,o=$(t.item),u=o.data("issue"),a=n.get(r?r-1:r),f=n.index(a),l=$(a).data("issue"),c=n.get(n.size()-1>r?r+1:r),h=n.index(c),p=$(c).data("issue"),d=u._data.order||u.number,v=l._data.order||l.number,m=p._data.order||p.number;if(i&&s)return;i?(u._data.order=(m||1)/2,o.trigger("reorder",u._data.order).data("issue",u)):s?(u._data.order=v+1,o.trigger("reorder",u._data.order).data("issue",u)):(u._data.order=(m+v||1)/2,o.trigger("reorder",u._data.order).data("issue",u))}});return i}),define("board/views/filterView",["../../common/events/postal"],function(e){return jQuery.Color.fn.contrastColor=function(){var e=this._rgba[0],t=this._rgba[1],n=this._rgba[2];return(e*299+t*587+n*144)/1e3>=131.5?"#333":"white"},Backbone.View.extend({tagName:"li",className:"filter",initialize:function(e){this.params=e,this.condition=e.condition,this.name=e.name,this.type=e.type||"Simple",this.state=0,this.states=[0,1,2,0]},events:{click:"clicked",clear:"clearAndPublish","click .ui-icon":"clearAndPublish"},render:function(){return $(this.el).html("<a href='#'>"+this.name+"<span class='ui-icon ui-icon-x'></span></a>").addClass("-x"+this.params.color.substring(1)).data("filter",this),this},clicked:function(e){e.preventDefault();switch(this.state=this.states[this.state+1]){case 0:this.clear();break;case 1:this.fade();break;case 2:this.solid()}this.publish()},clear:function(){$(this.el).find("a").removeClass("dim").removeClass("active")},publish:function(){e.publish("Filter."+this.type,{id:this.cid,condition:this.condition,state:this.state})},clearAndPublish:function(e){return e.preventDefault(),this.state=0,this.publish(),this.clear(),!1},fade:function(){$(this.el).find("a").addClass("dim").removeClass("active")},solid:function(){$(this.el).find("a").addClass("active").removeClass("dim")}})}),define("board/views/sidebarView",["../../common/events/postal","./filterView"],function(e,t){return Backbone.View.extend({tagName:"ul",className:"filters",initialize:function(e){this.milestones=e.data.milestones,this.login=e.params.login,this.labels=e.data.other_labels},render:function(){var e=$(this.el),n=this.login,r=(new t({color:"#0069D6",name:"Assigned to me",condition:function(e){return e.assignee&&e.assignee.login===n}})).render(),i=(new t({color:"#0069D6",name:"Assigned to others",condition:function(e){return e.assignee&&e.assignee.login!==n}})).render(),s=(new t({color:"#0069D6",name:"Unassigned issues",condition:function(e){return!e.assignee}})).render(),o=$([r.el,i.el,s.el]);e.append(o),o.click(function(e){e.preventDefault();var t=$(this),n=t.data("filter"),r=_(o).filter(function(e){var t=$(e).data("filter");return n.cid!==t.cid&&t.state!==0});_(r).each(function(e){$(e).trigger("clear")})});var u=_.groupBy(this.milestones,function(e){return e._data.status||"backlog"}),a=(u.wip||[]).concat(u.backlog||[]),f=_.map(a,function(e){return(new t({color:"#0069D6",name:e.title,count:e.open_issues,condition:function(t){return t.milestone&&t.milestone.title.toLocaleLowerCase()===e.title.toLocaleLowerCase()}})).render().el}),l=(new t({color:"#0069D6",name:"No milestone assigned",condition:function(e){return!e.milestone}})).render().el;e.append("<h5>Milestones</h5>"),e.append(l),e.append(f),$(f.concat(l)).click(function(e){e.preventDefault();var t=$(this),n=t.data("filter"),r=_(f.concat(l)).filter(function(e){var t=$(e).data("filter");return n.cid!==t.cid&&t.state!==0});_(r).each(function(e){$(e).trigger("clear")})});var c=_.map(this.labels,function(e){return(new t({color:"#"+e.color,name:e.name,condition:function(t){return _.any(t.labels,function(t){return t.name.toLocaleLowerCase()===e.name.toLocaleLowerCase()})}})).render().el});return e.append("<h5>Labels</h5>"),e.append(c),this}})}),define("board/views/headerView",["../../common/events/postal"],function(e){return Backbone.View.extend({el:$(".page-header-wrapper"),events:{"keyup input":"onkeyup"},initialize:function(t){var n=this,r=$(n.el).find("input");this.publish=_.debounce(function(){var t=r.val();e.publish("Filter.Simple",{id:"search",condition:function(e){return e.title.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())!==-1},state:2})},300),e.subscribe("Shortcut.Search",function(){r.focus()})},onkeyup:function(e){this.publish()}})}),define("text!board/templates/css.html",[],function(){return'<% \n_(["filter","card-label"]).each(function(name){\n  _(other_labels).each(function(l) {\n%>\n  .<%= name %>.-x<%= l.color %>.active, .<%= name %>.-x<%= l.color %>.active:hover  {\n    background-color: #<%= l.color %>;\n    background-color: <%= $.Color("#" + l.color).toString() %>;\n    color: <%= $.Color("#" + l.color).contrastColor() %>;\n  }\n\n  .<%= name %>.-x<%= l.color %> .active, .<%= name %>.-x<%= l.color %> .active:hover  {\n    background-color: #<%= l.color %>;\n    background-color: <%= $.Color("#" + l.color).toString() %>;\n    color: <%= $.Color("#" + l.color).contrastColor() %>;\n  }\n  \n  .<%= name %>.-x<%= l.color %>.dim, .<%= name %>.-x<%= l.color %>.dim:hover  {\n    background-color: <%= $.Color($.Color("#" + l.color).alpha(0.6)).toString() %>;\n    color: <%= $.Color("#" + l.color).contrastColor() %>;\n  }\n\n  .<%= name %>.-x<%= l.color %> .dim ,  .<%= name %>.-x<%= l.color %> .dim:hover {\n    background-color: <%= $.Color($.Color("#" + l.color).alpha(0.6)).toString() %>;\n    color: <%= $.Color("#" + l.color).contrastColor() %>;\n  }\n\n  <%})});%>\n'}),define("board/views/cssView",["../collections/issues","text!../templates/css.html"],function(e,t){e.bind("ondatareceived",function(e){var n=_.template(t,e),r=document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n)),r.appendChild(i)})}),define("board/views/board",["../collections/issues","text!../templates/board.html","./columnView","./sidebarView","./headerView","../../common/views/assigneeView","../../common/events/postal","./cssView","../../common/spinner"],function(e,t,n,r,i,s,o,u,a){var f=function(){var e=_($("ul")).chain().map(function(e){return $(e).height()}).reduce(function(e,t){return t>e?t:e}).value();return e},l=function(e){switch(e){case"open":$("#drawer").find(".toggle-drawer").removeClass("arrow-right").addClass("arrow-left").end().animate({left:"+=270px"},300),$("#content").animate({"margin-left":"+=100px"},300);break;case"close":$("#drawer").animate({left:"-=270px"},300,function(){$(this).find(".toggle-drawer").removeClass("arrow-left").addClass("arrow-right").end()}),$("#content").animate({"margin-left":"-=100px"},300)}};return Backbone.View.extend({el:$("#stage"),events:{"click .toggle-drawer":"toggleDrawer"},initialize:function(t){e.bind("ondatareceived",this.onfetch,this),e.bind("afterreceived",this.resizeColumns,this),this.overlay=$("<div class='fullscreen-overlay'>"),$("#wrapper").append(this.overlay.show()),a.spin(this.overlay.get(0)),e.fetch(t.user,t.repo),this.user=t.user,this.repo=t.repo,this.params=t,o.subscribe("Opened.Issue",$.proxy(this.onOpened,this)),o.subscribe("Closed.Issue",$.proxy(this.onClosed,this))},onOpened:function(){this.resizeColumns()},onClosed:function(){this.resizeColumns()},onfetch:function(e){this.overlay.remove();var o=$(_.template(t,e)),u=o.clone(),a=_.first(e.labels),f=_.rest(e.labels),l=new r({data:e,params:this.params}),c=new i,h=new s({data:e,params:this.params}),p=this;$(u).append((new n({column:a,user:this.user,repo:this.repo})).render().el);var d=100/f.length;_.each(f,function(e){var t=new n({column:e,user:p.user,repo:p.repo}),r=$(t.render().el).css({width:d+"%"});$(o).append(r)}),$("#stage").append(o),$("#drawer","#main-stage").append(u).find(".toggle-drawer").show(),$(".sidebar-wrapper").append(l.render().el).show(),$('[rel~="twipsy"]').tooltip({live:!0}),this.resizeColumns()},resizeColumns:function(){var e=f();$("ul","#main-stage").css("min-height",e)},toggleDrawer:function(e){e.preventDefault();var t=$(".toggle-drawer").hasClass("arrow-left");t?l("close"):l("open")}})}),function(){function h(e,t,n){if(e.addEventListener){e.addEventListener(t,n,!1);return}e.attachEvent("on"+t,n)}function p(n){if(n.type=="keypress"){var r=String.fromCharCode(n.which);return n.shiftKey||(r=r.toLowerCase()),r}return e[n.which]?e[n.which]:t[n.which]?t[n.which]:String.fromCharCode(n.which).toLowerCase()}function d(e,t){return e.sort().join(",")===t.sort().join(",")}function v(e){e=e||{};var t=!1,n;for(n in u){if(e[n]){t=!0;continue}u[n]=0}t||(l=!1)}function m(e,t,n,r,i,o){var a,f,l=[],c=n.type;if(!s[e])return[];c=="keyup"&&E(e)&&(t=[e]);for(a=0;a<s[e].length;++a){f=s[e][a];if(!r&&f.seq&&u[f.seq]!=f.level)continue;if(c!=f.action)continue;if(c=="keypress"&&!n.metaKey&&!n.ctrlKey||d(t,f.modifiers)){var h=!r&&f.combo==i,p=r&&f.seq==r&&f.level==o;(h||p)&&s[e].splice(a,1),l.push(f)}}return l}function g(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function y(e,t,n){if(O.stopCallback(t,t.target||t.srcElement,n))return;e(t,n)===!1&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,t.cancelBubble=!0)}function b(e,t,n){var r=m(e,t,n),i,s={},o=0,u=!1;for(i=0;i<r.length;++i)r[i].seq&&(o=Math.max(o,r[i].level));for(i=0;i<r.length;++i){if(r[i].seq){if(r[i].level!=o)continue;u=!0,s[r[i].seq]=1,y(r[i].callback,n,r[i].combo);continue}u||y(r[i].callback,n,r[i].combo)}n.type==l&&!E(e)&&v(s)}function w(e){typeof e.which!="number"&&(e.which=e.keyCode);var t=p(e);if(!t)return;if(e.type=="keyup"&&f===t){f=!1;return}O.handleKey(t,g(e),e)}function E(e){return e=="shift"||e=="ctrl"||e=="alt"||e=="meta"}function S(){clearTimeout(a),a=setTimeout(v,1e3)}function x(){if(!i){i={};for(var t in e){if(t>95&&t<112)continue;e.hasOwnProperty(t)&&(i[e[t]]=t)}}return i}function T(e,t,n){return n||(n=x()[e]?"keydown":"keypress"),n=="keypress"&&t.length&&(n="keydown"),n}function N(e,t,n,r){function i(t){return function(){l=t,++u[e],S()}}function s(t){y(n,t,e),r!=="keyup"&&(f=p(t)),setTimeout(v,10)}u[e]=0;for(var o=0;o<t.length;++o){var a=o+1===t.length,c=a?s:i(r||k(t[o+1]).action);L(t[o],c,r,e,o)}}function C(e){return e==="+"?["+"]:e.split("+")}function k(e,t){var i,s,o,u=[];i=C(e);for(o=0;o<i.length;++o)s=i[o],r[s]&&(s=r[s]),t&&t!="keypress"&&n[s]&&(s=n[s],u.push("shift")),E(s)&&u.push(s);return t=T(s,u,t),{key:s,modifiers:u,action:t}}function L(e,t,n,r,i){o[e+":"+n]=t,e=e.replace(/\s+/g," ");var u=e.split(" "),a;if(u.length>1){N(e,u,t,n);return}a=k(e,n),s[a.key]=s[a.key]||[],m(a.key,a.modifiers,{type:a.action},r,e,i),s[a.key][r?"unshift":"push"]({callback:t,modifiers:a.modifiers,action:a.action,seq:r,level:i,combo:e})}function A(e,t,n){for(var r=0;r<e.length;++r)L(e[r],t,n)}var e={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},t={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},r={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},i,s={},o={},u={},a,f=!1,l=!1;for(var c=1;c<20;++c)e[111+c]="f"+c;for(c=0;c<=9;++c)e[c+96]=c;h(document,"keypress",w),h(document,"keydown",w),h(document,"keyup",w);var O={bind:function(e,t,n){return e=e instanceof Array?e:[e],A(e,t,n),this},unbind:function(e,t){return O.bind(e,function(){},t)},trigger:function(e,t){return o[e+":"+t]&&o[e+":"+t]({},e),this},reset:function(){return s={},o={},this},stopCallback:function(e,t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:t.tagName=="INPUT"||t.tagName=="SELECT"||t.tagName=="TEXTAREA"||t.contentEditable&&t.contentEditable=="true"},handleKey:b};window.Mousetrap=O,typeof define=="function"&&define.amd&&define("mousetrap",O)}(),define("common/shortcuts",["../mousetrap","common/events/postal"],function(e,t){return{help:function(){t.publish("Shortcut.Help")},exit:function(){t.publish("Shortcut.Exit")},search:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,t.publish("Shortcut.Search")},init:function(){e.bind("?",this.help),e.bind("/",this.search),e.bind("esc",this.exit)}}}),define("board/main",["./views/board","../common/shortcuts"],function(e,t){var n={};return{init:function(r){n.board=new e(r),t.init()}}}),define("text!card/templates/card.html",[],function(){return'<div class="fullscreen-card-right">\n      <h2> <a class="number" href="<%= html_url %>" target="_blank" title="View issue on github.com"><small>ISSUE #</small><%= number %></a> </h2>\n      <div class="labels-placeholder"></div>\n</div>\n<div class="fullscreen-card-left">\n  <div class=\'fullscreen-card-preamble\'>\n    <div class="fullscreen-header">\n      <h2> <%- title %> </h2>\n    </div>\n  </div>\n  <div class="fullscreen-card-description card-comment">\n    <a href="<%= user.html_url %>" target="_blank">\n      <img title="Created by <%= user.login %>" src="https://secure.gravatar.com/avatar/<%= user.gravatar_id%>?s=30" />\n    </a>\n    <div class="comment-body">\n      <%= body_html %>\n    </div>\n  </div>\n</div>\n'}),define("text!card/templates/feed.html",[],function(){return'\n  <div class="fullscreen-card-activity">\n    <div class="fullscreen-header">\n      <h4> Activity </h4>\n    </div>\n    <% _(issue.comments).each(function(c) { %>\n    <div class="card-comment">\n      <a href="<%= c.user.html_url %>" target="_blank">\n        <img title="Created by <%= c.user.login %>" src="https://secure.gravatar.com/avatar/<%= c.user.gravatar_id%>?s=30" />\n      </a>\n      <div class="comment-body">\n        <%= c.body_html %>\n      </div>\n    </div>\n    <% }); %>\n  </div>\n'}),define("text!card/templates/actions/labels.html",[],function(){return'\n\n  <ul class="labels"> \n    <h5> Labels </h5>\n  <% _(available_labels).each(function(l) { %>\n    <li class="card-label -x<%= l.color %>"> \n    <% if(_.find(current_labels, function(x){ return x.name === l.name})) { %>\n      <span class="active"> <%- l.name %> </span>\n      <input type="checkbox" style="display:none" name="labels[name][]" value=\'<%= l.name %>\' checked=\'checked\' />\n      <% } else {  %>\n        <span > <%- l.name %> </span>\n        <input type=\'checkbox\' style="display:none" name="labels[name][]" value=\'<%- l.name %>\' />\n      <% } %>\n    </li>\n  <% }); %>\n  </ul>\n'}),define("card/views/actions/labels",["text!../../templates/actions/labels.html"],function(e){var t=Backbone.View.extend({initialize:function(e,t){this.data=e,this.issue=t},events:{"click li":"update"},render:function(){var t=this.issue,n="/api/"+t.attributes.repo.owner.login+"/"+t.attributes.repo.name+"/issues/"+t.attributes.number+"/update_labels";return $(this.el).append("<form action='"+n+"'>").find("form").html(_.template(e,this.data)),this},update:function(e,t){var n=$(e.currentTarget),r=n.find("span").toggleClass("active"),i=n.find("input");i.prop("checked",!i.prop("checked"));var s=$(this.el).find("form"),o=s.serialize();$.ajax({url:s.attr("action"),data:o,dataType:"json",type:"POST"}).done(function(e){console.log(e)})}});return{create:function(e,n){return new t(e,n)}}}),define("card/views/card",["../../common/events/postal","text!../templates/card.html","text!../templates/feed.html","./actions/labels"],function(e,t,n,r){var i={labels:r};return Backbone.View.extend({tagName:"div",className:"fullscreen-card",initialize:function(t){e.subscribe("Card.Fullscreen",$.proxy(this.open,this))},render:function(e){return $(this.el).html(_.template(t,e)),this},open:function(e){var t=this;this.issue=e,this.render(e.attributes),$.getJSON("/api/"+e.attributes.repo.owner.login+"/"+e.attributes.repo.name+"/issues/"+e.attributes.number+"/feed").done(function(e){$(t.el).find(".fullscreen-card-left").append(_.template(n,e));var r=null;for(r in e.actions)$(t.el).find("."+r+"-placeholder").append(i[r].create(e.actions[r],t.issue).render().el)})}})}),define("card/main",["../common/events/postal","./views/card"],function(e,t){var n={open:function(){$("body").addClass("fullscreen-open")},close:function(){$("body").removeClass("fullscreen-open")},init:function(){$(".fullscreen-wrapper > div").click(function(e){e.stopPropagation()}),$(".fullscreen-overlay").click(n.close),e.subscribe("Card.Fullscreen",$.proxy(this.open,this)),e.subscribe("Shortcut.Exit",n.close)}};return{init:function(e){n.card=new t(e),$(this).append(n.card.el),n.init()}}});